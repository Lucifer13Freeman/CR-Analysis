
<!-- <mat-table [dataSource]="dataSource">
    <ng-container *ngFor="let column of columns" [matColumnDef]="column.key">
        <mat-header-cell *matHeaderCellDef>{{ column.header }}</mat-header-cell>
        <mat-cell *matCellDef="let row">{{ column.cell(row) }}</mat-cell>
    </ng-container>
</mat-table> -->

<!-- <article>
    <table mat-table [dataSource]="dataSource">
        <ng-container [matColumnDef]="col.key" *ngFor="let col of columnsSchema">
            <th mat-header-cell *matHeaderCellDef>
                {{col.label}}
            </th>
            <td mat-cell *matCellDef="let element">
                <mat-form-field>
                    <input [type]="col.type" matInput [(ngModel)]="element[col.key]">
                </mat-form-field>
            </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
</article> -->

<ng-container *ngIf="tableData.data.length !== 0">
  <div class="mat-elevation-z8 table-container">

    <ng-container *ngIf="withToolbar">
      <div class="data-table-toolbar">
        <mat-form-field class="search-input" appearance="standard">
          <mat-label>Поиск</mat-label>
          <input matInput 
            (keyup)="applyFilter($event)" 
            placeholder="Поиск" 
            #input
          />
        </mat-form-field>

        <div class="table-toolbar-buttons">
          <ng-container *ngIf="isEditable">
            <!-- <div> -->
            <button 
              class="button-add-row" 
              mat-raised-button 
              (click)="addRow()"
            >
              Добавить
            </button>
            <button 
              class="button-remove-rows" 
              mat-raised-button 
              (click)="removeSelectedRows()"
            >
              Удалить
            </button>
            <!-- </div> -->
            <!-- <div>
            <button class="button-confirm" mat-button (click)="confirmChanges()">Confirm changes</button>
            <button class="button-cancel" mat-button (click)="cancelChanges()">Cancel changes</button>
            </div> -->
          </ng-container>
          <!-- <div> -->
          <button 
            mat-raised-button 
            class="button-edit"
            (click)="isEditable = !isEditable"
          >
            Редактировать
          </button>
          <!-- </div> -->
        </div>
      </div>
    </ng-container>
    
    <div [ngClass]="{'table-size': !isEditable, 'mat-elevation-z8': !isEditable}">
      <table
        mat-table 
        [dataSource]="dataSource"
      >
        <!-- #table
        cdkDropList
        [cdkDropListData]="dataSource.data"
        (cdkDropListDropped)="dropTable($event)"
      > -->
        <ng-container [matColumnDef]="col.key" *ngFor="let col of columnsSchema">
          <th
            mat-header-cell 
            *matHeaderCellDef
          >
            {{col.label}}
          </th>
          
          
          <td 
            mat-cell 
            *matCellDef="let element" 
          >

            <div *ngIf="isEditable; then thenBlock else elseBlock"></div>

            <div [ngSwitch]="col.type">

              <ng-template #thenBlock>
                <ng-container *ngSwitchCase="'isSelected'">
                  <!-- <mat-icon cdkDragHandle>reorder</mat-icon> -->
                  <mat-checkbox
                    class="checkbox"
                    (change)="element.isSelected = $event.checked"
                  ></mat-checkbox>
                </ng-container>
                
                <ng-container *ngSwitchCase="'text'">
                  <mat-form-field class="form-input">
                    <input 
                      [type]="col.type" 
                      matInput
                      [(ngModel)]="element[col.key]"
                      (change)="editData()"
                      required="true"
                    />
                  </mat-form-field>
                </ng-container>  
              </ng-template>

              <ng-template #elseBlock>
                <ng-container *ngSwitchCase="'isSelected'"></ng-container>

                <ng-container *ngSwitchCase="'text'">
                  <input 
                    [ngClass]="{'data-input': col.key !== 'id'}"
                    matInput
                    [(ngModel)]="element[col.key]"
                    readonly
                  />
                  <!-- {{element[col.key]}} -->
                  <!-- <div>{{element[col.key]}}</div> -->
                </ng-container>
              </ng-template>
          
            </div>

          </td>
        </ng-container>
        
        <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        <!-- cdkDrag [cdkDragData]="row"></tr> -->

      </table>
    </div>

    <ng-container *ngIf="isPageble">
      <mat-paginator 
        [pageSizeOptions]="[5, 10, 20]"
        [pageSize]="10"
        showFirstLastButtons 
        aria-label="Select page">
      </mat-paginator>
    </ng-container>

  </div>
</ng-container >

<!-- <table mat-table [dataSource]="dataSource">
    <ng-container [matColumnDef]="col.key" *ngFor="let col of columnsSchema">
      <th mat-header-cell *matHeaderCellDef>
        {{ col.label }}
      </th>
      <td mat-cell *matCellDef="let element">
        <div [ngSwitch]="col.type" *ngIf="!element.isEdit">
          <div class="btn-edit" *ngSwitchCase="'isEdit'">
            <button mat-button (click)="element.isEdit = !element.isEdit">
              Edit
            </button>
          </div>
          <span *ngSwitchCase="'date'">
            {{ element[col.key] | date: 'mediumDate' }}
          </span>
          <span *ngSwitchDefault>
            {{ element[col.key] }}
          </span>
        </div>
        <div [ngSwitch]="col.type" *ngIf="element.isEdit">
          <div class="btn-edit" *ngSwitchCase="'isEdit'">
            <button mat-button (click)="element.isEdit = !element.isEdit">
              Done
            </button>
          </div>
          <mat-form-field
            class="form-input"
            *ngSwitchCase="'date'"
            appearance="fill"
          >
            <mat-label>Choose a date</mat-label>
            <input
              matInput
              [matDatepicker]="picker"
              [(ngModel)]="element[col.key]"
            />
            <mat-datepicker-toggle
              matSuffix
              [for]="picker"
            ></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
          </mat-form-field>
          <mat-form-field class="form-input" *ngSwitchCase="'number'">
            <input
              type="number"
              matInput
              (ngModelChange)="element[col.key] = $event"
              [ngModel]="element[col.key]"
            />
          </mat-form-field>
          <mat-form-field class="form-input" *ngSwitchDefault>
            <input [type]="col.type" matInput [(ngModel)]="element[col.key]" />
          </mat-form-field>
        </div>
      </td>
    </ng-container>
    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
</table> -->